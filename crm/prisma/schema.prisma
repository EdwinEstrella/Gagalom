generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model crm_accounts {
  id                  String    @id
  type                String
  provider            String
  provider_account_id String
  refresh_token       String?
  access_token        String?
  expires_at          Int?
  token_type          String?
  scope               String?
  id_token            String?
  session_state       String?
  user_id             String
  crm_users           crm_users @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([provider, provider_account_id])
  @@index([user_id])
}

model crm_sessions {
  id            String    @id
  session_token String    @unique
  expires       DateTime
  user_id       String
  crm_users     crm_users @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model crm_users {
  id            String         @id
  email         String         @unique
  password_hash String
  name          String?
  role          String         @default("staff")
  is_active     Boolean        @default(true)
  last_login    DateTime?
  created_at    DateTime       @default(now())
  updated_at    DateTime
  crm_accounts  crm_accounts[]
  crm_sessions  crm_sessions[]
}

model crm_verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model order_items {
  id            Int      @id @default(autoincrement())
  order_id      Int
  product_id    Int
  quantity      Int
  price_at_time Decimal  @db.Decimal(10, 2)
  orders        orders   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  products      products @relation(fields: [product_id], references: [id])

  @@index([order_id])
}

model orders {
  id                       Int           @id @default(autoincrement())
  user_id                  Int
  stripe_payment_intent_id String?       @unique
  total_amount             Decimal       @db.Decimal(10, 2)
  status                   String        @default("pending")
  shipping_address         String?
  created_at               DateTime      @default(now())
  updated_at               DateTime
  order_items              order_items[]
  users                    users         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([stripe_payment_intent_id])
  @@index([user_id])
}

model products {
  id               Int           @id @default(autoincrement())
  seller_id        Int?
  name             String
  description      String?
  price            Decimal       @db.Decimal(10, 2)
  category         String
  image_url        String?
  local_asset_path String?
  stock            Int           @default(0)
  is_active        Boolean       @default(true)
  stripe_price_id  String?
  views            Int           @default(0)
  sales_count      Int           @default(0)
  rating           Decimal       @default(0) @db.Decimal(3, 2)
  created_at       DateTime      @default(now())
  updated_at       DateTime
  order_items      order_items[]
  users            users?        @relation(fields: [seller_id], references: [id])

  @@index([category])
  @@index([is_active])
  @@index([seller_id])
}

model seller_requests {
  id                   Int       @id @default(autoincrement())
  user_id              Int
  business_name        String
  business_description String?
  business_type        String?
  tax_id               String?
  phone                String?
  address              String?
  city                 String?
  country              String    @default("Espa√±a")
  status               String    @default("pending")
  rejection_reason     String?
  reviewed_by          Int?
  reviewed_at          DateTime?
  created_at           DateTime  @default(now())
  updated_at           DateTime
  users                users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([user_id])
}

model users {
  id                 Int               @id @default(autoincrement())
  email              String            @unique
  password_hash      String
  first_name         String?
  last_name          String?
  gender             String?
  age_range          String?
  role               String            @default("customer")
  stripe_customer_id String?
  is_active          Boolean           @default(true)
  last_login         DateTime?
  created_at         DateTime          @default(now())
  updated_at         DateTime
  orders             orders[]
  products           products[]
  seller_requests    seller_requests[]
}
